{% extends "base.html" %}
{% block title %}Recherche avancée{% endblock %}

{% block content %}
  <div class="card">
    <h2 style="margin-top:0">Recherche avancée</h2>
    <form method="get" action="{{ url_for('advanced_search_page') }}" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; align-items:end">
      <div>
        <label style="color:var(--muted);font-size:13px">Mot-clé</label>
        <input name="q" value="{{ q }}">
      </div>
      <div>
        <label style="color:var(--muted);font-size:13px">Source (ex: wired.com)</label>
        <input name="source" value="{{ source }}">
      </div>
      <div>
        <label style="color:var(--muted);font-size:13px">Catégorie</label>
        <input name="category" value="{{ category }}">
      </div>
      <div>
        <label style="color:var(--muted);font-size:13px">Confiance min (0.0-1.0)</label>
        <input name="min_conf" type="number" step="0.01" min="0" max="1" value="{{ min_conf }}">
      </div>
      <div>
        <label style="color:var(--muted);font-size:13px">Date depuis (YYYY-MM-DD)</label>
        <input name="date_from" type="date" value="{{ date_from }}">
      </div>
      <div>
        <label style="color:var(--muted);font-size:13px">Date jusqu'à (YYYY-MM-DD)</label>
        <input name="date_to" type="date" value="{{ date_to }}">
      </div>

      <div style="grid-column:1 / -1; display:flex; gap:8px; align-items:center">
        <button class="btn" type="submit">Filtrer</button>
        <a class="btn ghost" href="{{ url_for('index') }}">Retour</a>
        <a class="btn" id="csvlink" href="/export_csv?{{ request.query_string.decode('utf-8') }}">Exporter CSV</a>
        <div style="margin-left:auto;color:var(--muted);font-size:13px">Résultats limités à 500</div>
      </div>
    </form>
  </div>

  <div class="card">
    <h3>Résultats ({{ rows|length }})</h3>
    <table>
      <thead><tr><th>Date</th><th>Source</th><th>Titre</th><th>Cat.</th><th>Conf.</th><th></th></tr></thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td style="width:130px">{{ r[3] or '-' }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[0] }}</td>
          <td><span class="pill blue">{{ r[4] or 'other' }}</span></td>
          <td><span class="score">{{ '%.2f'|format(r[5] or 0) }}</span></td>
          <td><a class="btn" href="{{ r[7] }}" target="_blank" rel="noopener">Source</a></td>
        </tr>
        {% endfor %}
        {% if rows|length == 0 %}
        <tr><td colspan="6" style="color:var(--muted);padding:18px">Aucun résultat. Essaie d'élargir ta recherche.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
